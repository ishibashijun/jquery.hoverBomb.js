/**
 * Name: jquery.hoverBomb.js
 * Description: Explode text on hover
 * Copyright (c) 2012 Jun Ishibashi
 * Version: 0.0.4
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */ 
(function(k){k.fn.hoverBomb=function(b){var f={direction:"all",radius:100,shakeRadius:1,shakeRotate:45,growSpeed:1,explosionMomentum:50,afterEffect:"fade",afterAnimationSpeed:500},j=function(){this.config=k.extend({},f,b);this.shakeRadius=this.config.shakeRadius;this.shakeLimit=10*this.config.shakeRadius;this.growSpeed=250*this.config.growSpeed;this.explodeLoop=this.growLoop=this.loop=null;this.exploded=!1;this.FPS=new o(30)};j.prototype={explode:function(a){this.exploded=!0;clearInterval(this.loop);
clearInterval(this.growLoop);this.shakeRadius=this.config.shakeRadius;for(var m=this,d=a.children("span"),b=d.length,c=this.config,e,g,i=[],f=0,a=0;a<b;a++)i[a]=[],e=h(-c.radius,c.radius),g=h(-c.radius,c.radius),i[a][0]=0>e&&e<-(c.radius>>1)?e:0<=e&&e>c.radius>>1?e:0>e&&e>-(c.radius>>1)?-(c.radius>>1):c.radius>>1,i[a][1]=0>g&&g<-(c.radius>>1)?g:0<=g&&g>c.radius>>1?g:0>g&&g>-(c.radius>>1)?-(c.radius>>1):c.radius>>1,e=i[a][0]-parseInt(d.eq(a).css("left"),10),g=i[a][1]-parseInt(d.eq(a).css("top"),10),
i[a][2]=Math.sqrt(e*e+g*g),i[f][2]<i[a][2]&&(f=a);this.explodeLoop=setInterval(function(){for(var a=0;a<b;a++){var e=parseInt(d.eq(a).css("top"),10),g=parseInt(d.eq(a).css("left"),10),h=i[a][0]-g,j=i[a][1]-e,l=Math.atan2(j,h),k=Math.cos(l)*c.explosionMomentum,l=Math.sin(l)*c.explosionMomentum,h=k*(h/i[a][0]),j=l*(j/i[a][1]),g=g+h,e=e+j;d.eq(a).css({top:e,left:g});if(a==f&&1>Math.abs(h)||1>Math.abs(j))if(clearInterval(m.explodeLoop),"animate"==c.afterEffect)setTimeout(function(){for(var a=0;a<b;a++)a!=
f?d.eq(a).animate({top:0,left:0},c.callbackAnimationSpeed):d.eq(f).animate({top:0,left:0},c.callbackAnimationSpeed,function(){for(var a=0;a<b;a++)d.eq(a).css({"-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"});m.exploded=!1})},c.afterAnimationSpeed);else if("fade"==c.afterEffect){e=0;for(g=b-1;e<g;e++)d.eq(e).fadeOut(500);d.eq(g).fadeOut(500,function(){for(var a=0,c=b-1;a<c;a++)n(d.eq(a)),d.eq(a).show(500);
n(d.eq(c));d.eq(c).show(500,function(){m.exploded=!1})})}}},this.FPS.getFPS())},preExplode:function(a){var b=this,d=a.children("span"),f=d.length,c=this.config;this.loop=setInterval(function(){for(var a=0;a<f;a++)d.eq(a).css({top:h(-b.shakeRadius,b.shakeRadius),left:h(-b.shakeRadius,b.shakeRadius),"-webkit-transform":"rotate("+h(-c.shakeRotate,c.shakeRotate)+"deg)","-moz-transform":"rotate("+h(-c.shakeRotate,c.shakeRotate)+"deg)","-ms-transform":"rotate("+h(-c.shakeRotate,c.shakeRotate)+"deg)","-o-transform":"rotate("+
h(-c.shakeRotate,c.shakeRotate)+"deg)",transform:"rotate("+h(-c.shakeRotate,c.shakeRotate)+"deg)"})},this.FPS.getFPS());this.growLoop=setInterval(function(){b.shakeRadius+=b.shakeRadius;b.shakeRadius>b.shakeLimit&&b.explode(a)},b.growSpeed)},cancelExplode:function(a){if(!this.exploded){clearInterval(this.loop);clearInterval(this.growLoop);this.shakeRadius=this.config.shakeRadius;for(var a=a.children("span"),b=a.length,d=0;d<b;d++)n(a.eq(d))}}};return this.each(function(){var a=k(this),b;b=a.text();
for(var d=0,f=b.length,c="";d<f;d++)c+='<span style="position: relative;">'+(""==b[d]?"&nbsp;":b[d])+"</span>";b=c;var e=new j;a.html(b);a.on("mouseenter",function(){e.preExplode(a)});a.on("mouseleave",function(){e.cancelExplode(a)})})};var o=function(b){var f=new Date,h=1E3/b;this.getFPS=function(){var a=new Date-f;return 10<h-a?h-a:10}},h=function(b,f,h){return b?f?(b=b>f?f:b,h?0<=b?b+Math.random()*(f-b):b+Math.random()*(f<<1):0<=b?b+Math.round(Math.random()*(f-b)):b+Math.round(Math.random()*(f<<
1))):Math.round(Math.random()*b):Math.random()},n=function(b){b.css({top:0,left:0,"-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"})}})(jQuery);
